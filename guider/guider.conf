'''
[ threshold config ]
- resource
    - cpu
    - mem
    - swap
    - block
    - storage
    - net
    - task
- target
    - SYSTEM: system resources
    - TASK: task resources (except for Guider)
    - NAME: specific task, device, event
- field
    - apply: switch flag
    - ATTR: detailed attribute fields for threshold
    - perm: requirement for permission
    - interval: condition for duration
    - command: event handlers
    - task: monitor tasks
    - message: message to be printed
    - oneshot: oneshot flag
    - explain: description
- variable
    - EVTNAME: event name
    - EVTTIME: event time
    - EVTPID: task PID
    - SELFPID: Guider PID
- special character
    - #: ignore a line
    - ''': ignore specific range
'''

<threshold>
{
    "COMMAND": {

        #"SAVE":  "embedded command to save the monitoring results to the file",
        #"SAVE_TIME":  "embedded command to save the monitoring results from the past to some time thereafter",
        "CMD_NOTIFY_WARN": "GUIDER cli upstream:notify:WARN",
        "CMD_TOP": "GUIDER top -o /tmp/guider_top_EVTNAME_EVTTIME.out -R 10 -Y c:15 -u",
        "CMD_FTOP": "GUIDER ftop -o /tmp/guider_top_EVTNAME_EVTTIME.out -R 1 -Y c:15 -u",
        "CMD_MEMTOP": "GUIDER memtop -o /tmp/guider_top_EVTNAME_EVTTIME.out -R 3 -Y c:15 -u",
        "CMD_FUNCREC": "GUIDER funcrec -s /tmp/guider_funcrec_EVTNAME_EVTTIME.dat -R 3 -u",
        "CMD_DISKTOP": "GUIDER disktop -R 3 -a -o /tmp/guider_block_EVTNAME_EVTTIME.out -Y c:15 -u",
        "CMD_DISKTOP_TOTAL": "GUIDER disktop -e T -R 3 -a -o /tmp/block_EVTNAME_EVTTIME.out -Y c:15 -u",
        "CMD_NETTOP": "GUIDER ntop -R 3 -o /tmp/guider_task_EVTNAME_EVTTIME.out -Y c:15 -u",
        "CMD_TTOP_CTX": "GUIDER ttop -S C:1 -R 2 -o /tmp/guider_task_EVTNAME_EVTTIME.out -Y c:15 -u",
        "CMD_TTOP_UTOP": "GUIDER ttop -g EVTPID -P -S c:1 -e E -R 1 -u -Q -c \"GUIDER utop -g PID -H -o /tmp/guider_utop_EVTNAME_EVTTIME_COMM_PID.out -R 3 -u\"",
        "CMD_LEAK_1G": "GUIDER leaktrace -g EVTPID -T /tmp/libleaktracer.so -o /tmp/guider_leak_EVTNAME_EVTTIME.out -c 1g -u",
        "CMD_LEAK_100M": "GUIDER leaktrace -g EVTPID -T /tmp/libleaktracer.so -o /tmp/guider_leak_EVTNAME_EVTTIME.out -c 100m -u"

    },

    "cpu": {

        "SYSTEM": [
            {
                "apply": "true",
                "total": 95,
                "interval": 2,
                "task": "true",
                "message": "system CPU usage is high",
                "command": ["SAVE_5s"],
                "explain": "save monitoring results"
            },

            {
                "apply": "false",
                "total": 97,
                "interval": 5,
                "message": "system CPU usage is critical",
                "perm": "root",
                "command": ["CMD_TOP", "CMD_FUNCREC"],
                "explain": "trace processes for 10 seconds, trace functions for all threads for 3 seconds"
            }
        ],

        "TASK": [
            {
                "apply": "false",
                "total": 95,
                "interval": 5,
                "perm": "root",
                "except": ["b.out"],
                "command": ["CMD_TTOP_UTOP"],
                "explain": "trace functions for threads using CPU in specific processes for 3 seconds"
            }
        ],

        "mutex5": [
            {
                "apply": "false",
                "total": 98,
                "interval": 3,
                "perm": "root",
                "oneshot": "true",
                "command": ["CMD_TTOP_UTOP"],
                "explain": "trace functions for threads using CPU in mutex5 processes for 3 seconds"
            }
        ]

    },

    "mem": {

        "SYSTEM": {
            "apply": "true",
            "available": 100,
            "message": "system available memory is low",
            "command": ["CMD_MEMTOP"]
        },

        "TASK": {
            "apply": "false",
            "rss": 900,
            "perm": "root",
            "except": ["b.out"],
            "command": ["CMD_LEAK"],
            "explain": "trace functions for specific processes consuming MEMORY"
        },

        "a.out": {
            "apply": "false",
            "rss": 10,
            "perm": "root",
            "oneshot": "true",
            "command": ["CMD_LEAK_100M"],
            "explain": "trace functions for a.out processes consuming MEMORY"
        }

    },

    "swap": {

        "SYSTEM": {
            "apply": "false",
            "usagePer": 95,
            "perm": "root",
            "message": "system SWAP usage is high",
            "command": ["CMD_MEMTOP"],
            "explain": "trace system memory for 3 seconds"
        },

        "TASK": {
            "apply": "false",
            "swapOut": 100,
            "except": ["b.out"],
            "command": ["CMD_MEMTOP"],
            "explain": "trace task memory for 3 seconds"
        }

    },

    "block": {

        "SYSTEM": {
            "apply": "false",
            "ioWait": 10,
            "interval": 5,
            "perm": "root",
            "message": "system I/O is heavy",
            "command": ["CMD_DISKTOP"],
            "explain": "save storage usage such as busy state"
        },

        "TASK": {
            "apply": "false",
            "read": 102400000,
            "write": 102400000,
            "perm": "root",
            "interval": 2,
            "except": ["b.out"],
            "command": ["CMD_DISKTOP_TOTAL"],
            "explain": "trace task I/O"
        },

        "a.out": {
            "apply": "false",
            "read": 102400000,
            "write": 102400000,
            "interval": 2,
            "perm": "root",
            "command": ["CMD_DISKTOP_TOTAL"],
            "explain": "trace task I/O"
        }

    },

    "storage": {

        "SYSTEM": {
            "apply": "false",
            "usagePer": 95,
            "oneshot": "true",
            "perm": "root",
            "message": "system storage usage is high",
            "command": ["CMD_DISKTOP"],
            "explain": "save total storage usage"
        },

        "DEVICE": {
            "apply": "false",
            "usagePer": 99,
            "perm": "root",
            "oneshot": "true",
            "command": ["CMD_DISKTOP"],
            "explain": "save storage usage for all devices"
        },

        "/dev/sda2": {
            "apply": "false",
            "usagePer": 99,
            "perm": "root",
            "oneshot": "true",
            "command": ["CMD_DISKTOP"],
            "explain": "save storage usage for a specific device"
        }

    },

    "net": {

        "SYSTEM": {
            "apply": "false",
            "inbound": 1024000000,
            "outbound": 1024000000,
            "perm": "root",
            "interval": 3,
            "command": ["CMD_NETTOP"],
            "message": "system network usage is high",
            "explain": "save network usage for all devices"
        },

        "DEVICE": {
            "apply": "false",
            "recv": 1024000000,
            "trans": 1024000000,
            "perm": "root",
            "interval": 3,
            "command": ["CMD_NETTOP"],
            "explain": "save network usage for specific devices"
        },

        "enp7s0": {
            "apply": "false",
            "recv": 1024000000,
            "trans": 1024000000,
            "perm": "root",
            "interval": 3,
            "command": ["CMD_NETTOP"],
            "explain": "save network usage for specific devices"
        }

    },

    "fd": {

        "SYSTEM": {
            "apply": "false",
            "perm": "root",
            "command": ["CMD_FTOP"],
            "explain": "save file descriptor info for all tasks"
        },

        "TASK": {
            "apply": "false",
            "fdsize": 10000,
            "perm": "root",
            "oneshot": "true",
            "command": ["CMD_FTOP"],
            "interval": 3,
            "except": ["b.out"],
            "explain": "save file descriptor info for all tasks"
        },

        "a.out": {
            "apply": "false",
            "fdsize": 10000,
            "perm": "root",
            "oneshot": "true",
            "command": ["CMD_FTOP"],
            "interval": 3,
            "explain": "save file descriptor info for all tasks"
        }
    },

    "task": {

        "SYSTEM": [
            {
                "apply": "false",
                "nrCtx": 50000,
                "command": ["CMD_TTOP_CTX"],
                "explain": "save the number of context switch for threads"
            },

            {
                "apply": "false",
                "new": "true",
                "die": "true",
                "abnormal": "true",
                "command": ["CMD_TOP"],
                "explain": "save special status for tasks"
            }
        ],

        "TASK": {
            "apply": "false",
            "except": ["b.out"],
            "nrCtx": 5000
        },

        "a.out": {
            "apply": "false",
            "new": "true",
            "die": "true"
        }
    }
}



'''
[ server config ]
- COMMAND: shortcut for commands
- INIT: commands executed remotely when connected
    - apply: switch flag
    - perm: requirement for permission
    - interval: interval for repeatation (TBD)
    - duration: condition for duration
    - command: command set
    - oneshot: oneshot flag (TBD)
    - explain: description
- EVENT: event handlers
    - name: event name
    - apply: switch flag
    - command: commands executed when the event occur
    - handler: functions called when the event occur
- special character support: #, '''
'''

<server>
{
    "COMMAND": {

        "CMD_RTOP": "GUIDER rtop -Q -i 3 -C",
        "CMD_DOWN": "download:/tmp/*@./backup/",
        "CMD_MAIL": "mail -s \"Warning Report\" master@github.com"

    },

    "INIT": [

        {
            "apply": "false",
            "perm": "none",
            "oneshot": "true",
            "duration": "10s",
            "command": ["CMD_RTOP"],
            "explain": "print system stat in JSON format from the new node to stdout"
        },

        {
            "apply": "false",
            "perm": "none",
            "oneshot": "true",
            "command": ["CMD_RTOP->cat"],
            "explain": "deliver system stat in JSON format from the new node to the cat process in local machine through pipe"
        },

        {
            "apply": "false",
            "perm": "true",
            "oneshot": "false",
            "interval": "10s",
            "command": ["CMD_DOWN"],
            "explain": "download specific files from the new node every 10 seconds"
        }

    ],

    "EVENT": [

        {
            "name": "TEST",
            "apply": "false",
            "command": ["ls -lha", "CMD_MAIL"],
            "handler": ["./test.py:test"],
            "explain": "make a snapshot image for system"
        }

    ]
}



'''
[ auto command ]
- special character support: #, '''
'''

<command>
{
    "apply": "false",
    "list": [
        "GUIDER list",
        "ls -lha"
    ]
}
