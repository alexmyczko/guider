'''
- desc: threshold configuration for resource and event
- resource: cpu / mem / swap / block / storage / net / sched
- target: SYSTEM / TASK / name
- field: ATTR / interval / command / message / oneshot / apply / explanation
- variable: EVTNAME / EVTTIME / EVTPID / SELFPID
- special character support: #, '''
'''

<threshold>
{
    "cpu": {

        "SYSTEM": [
            {
                "apply": "true",
                "total": 90,
                "interval": 5,
                "message": "system CPU usage is high",
                "command": [
                    "GUIDER top -o /tmp/top_EVTNAME_EVTTIME.out -R 10 -u"
                ],
                "explanation": "trace processes for 10 seconds"
            },

            {
                "apply": "true",
                "total": 98,
                "interval": 5,
                "message": "system CPU usage is critical",
                "command": [
                    "GUIDER top -o /tmp/top_EVTNAME_EVTTIME.out -R 10 -u",
                    "GUIDER funcrec -s /tmp/funcrec_EVTNAME_EVTTIME.dat -R 3 -u"
                ],
                "explanation": "trace processes for 10 seconds, trace functions for all threads for 3 seconds"
            }
        ],

        "TASK": [
            {
                "apply": "false",
                "total": 95,
                "interval": 5,
                "command": [
                    "GUIDER ttop -g EVTPID -P -S c:1 -e E -R 1 -u -Q -c \"GUIDER utop -g PID -H -o /tmp/utop_EVTNAME_EVTTIME_COMM_PID.out -R 3 -u\""
                ],
                "explanation": "trace functions for threads using CPU in specific processes for 3 seconds"
            }
        ],

        "mutex5": [
            {
                "apply": "true",
                "total": 98,
                "interval": 3,
                "oneshot": "true",
                "command": [
                    "GUIDER ttop -g EVTPID -P -S c:1 -e E -R 1 -u -Q -c \"GUIDER utop -g PID -H -o /tmp/utop_EVTNAME_EVTTIME_COMM_PID.out -R 3 -u\""
                ],
                "explanation": "trace functions for threads using CPU in mutex5 processes for 3 seconds"
            }
        ]
    },

    "mem": {

        "SYSTEM": {
            "apply": "true",
            "available": 100,
            "command": [
		"GUIDER top -o /tmp/top_EVTNAME_EVTTIME.out -R 10 -u"
            ]
        },

        "TASK": {
            "apply": "false",
            "rss": 900,
            "command": [
                "GUIDER leaktrace -g EVTPID -T /tmp/libleaktracer.so -o /tmp/leak_EVTNAME_EVTTIME.out -c 1g -u"
            ],
            "explanation": "trace functions for specific processes consuming MEMORY"
        },

        "a.out": {
            "apply": "false",
            "rss": 10,
            "oneshot": "true",
            "command": [
                "GUIDER leaktrace -g EVTPID -T /tmp/libleaktracer.so -o /tmp/leak_EVTNAME_EVTTIME.out -c 100m -u"
            ],
            "explanation": "trace functions for a.out processes consuming MEMORY"
        }
    },

    "swap": {

        "SYSTEM": {
            "apply": "true",
            "usagePer": 95,
            "message": "system SWAP usage is high",
	    "command": [
	        "GUIDER memtop -o /tmp/top_EVTNAME_EVTTIME.out -R 3 -u"
	    ],
	    "explanation": "trace system memory for 3 seconds"
        }
    },

    "block": {

        "SYSTEM": {
            "apply": "true",
            "ioWait": 10,
            "interval": 5
        }
    },

    "storage": {

        "SYSTEM": {
            "apply": "true",
            "usagePer": 95,
            "oneshot": "true",
            "command": [
                "GUIDER disktop -R 1 -o /tmp/storage_EVTNAME_EVTTIME.out -u"
            ],
            "explanation": "save total storage usage"
        },

        "DEVICE": {
            "apply": "false",
            "usagePer": 99,
            "oneshot": "true",
            "command": [
                "GUIDER disktop -R 1 -o /tmp/storage_EVTNAME_EVTTIME.out -u"
            ],
            "explanation": "save storage usage for all devices"
        },

        "/dev/sda2": {
            "apply": "false",
            "usagePer": 99,
            "oneshot": "true",
            "command": [
                "GUIDER disktop -R 1 -o /tmp/storage_EVTNAME_EVTTIME.out -u"
            ],
            "explanation": "save storage usage for a specific device"
        }
    },

    "net": {

        "SYSTEM": {
            "apply": "false",
            "inbound": 1024000000,
            "outbound": 1024000000,
            "interval": 3,
	    "command": [
	        "GUIDER ntop -R 3 -o /tmp/task_EVTNAME_EVTTIME.out -u"
	    ],
	    "explanation": "save network usage for all devices"
        },

        "DEVICE": {
            "apply": "false",
            "recv": 1024000000,
            "trans": 1024000000,
            "interval": 3,
	    "command": [
	        "GUIDER ntop -R 3 -o /tmp/task_EVTNAME_EVTTIME.out -u"
	    ],
	    "explanation": "save network usage for specific devices"
        },

        "enp7s0": {
            "apply": "false",
            "recv": 1024000000,
            "trans": 1024000000,
            "interval": 3,
	    "command": [
	        "GUIDER ntop -R 3 -o /tmp/task_EVTNAME_EVTTIME.out -u"
	    ],
	    "explanation": "save network usage for specific devices"
        }

    },

    "task": {

        "SYSTEM": [
            {
                "apply": "false",
                "nrCtx": 50000,
                "command": [
                    "GUIDER ttop -S C:1 -R 2 -o /tmp/task_EVTNAME_EVTTIME.out -u"
                ],
                "explanation": "save the number of context switch for threads"
            },

            {
                "apply": "false",
                "new": "true",
                "die": "true",
                "abnormal": "true",
                "command": [
                    "GUIDER top -R 3 -o /tmp/task_EVTNAME_EVTTIME.out -u"
                ],
                "explanation": "save special status for tasks"
            }
        ],

        "TASK": {
            "apply": "true",
	    "nrCtx": 5000
        },

        "a.out": {
            "apply": "true",
            "new": "true",
            "die": "true"
        }
    }
}

<command>
GUIDER top -o -u
GUIDER list
sleep 5
GUIDER stop
